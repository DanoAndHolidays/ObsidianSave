# 浏览器存储
---
`sessionStorage本地存储`和`localStorage会话存储`是Web浏览器提供的两种用于在客户端存储数据的机制，它们都遵循同源策略（协议、域名、端口相同），以键值对（`key: value`）的形式存储数据，且存储的值==只能是字符串类型==（若存储其他类型，会自动转换为字符串，读取时需手动转换回原类型） 。

但在存储有效期、数据共享范围等方面存在差异：

| 特性         | sessionStorage                                                                                   | localStorage                                              |
| ---------- | ------------------------------------------------------------------------------------------------ | --------------------------------------------------------- |
| **有效期**    | 仅在当前会话（浏览器标签页或窗口打开期间）有效，==关闭标签页或窗口后==，存储的数据会被自动清除                                                | 除非主动调用代码删除或用户手动清除浏览器缓存，否则数据会==一直保留在本地==                   |
| **数据共享范围** | ==不同标签页或窗口==（即使是同一页面的不同实例）之间==无法共享==数据，只有在同一个标签页内通过`window.open`打开的新页面才能访问到相同的`sessionStorage`数据 | ==同一域名下==的所有页面都可以访问和修改`localStorage`中的数据，不同标签页、窗口之间数据是共享的 |
| **应用场景**   | 适合临时存储一些仅在当前会话中使用的数据，比如多步骤表单中每一步的临时数据、当前会话的用户浏览记录等                                               | 适用于需要长期保存的用户偏好设置（如主题设置、字体大小等）、用户登录状态的持久化存储等               |
 
常用方法
`sessionStorage`和`localStorage`拥有相似的方法：
- **存储数据（`setItem`）**：使用`setItem`方法可以向`sessionStorage`或`localStorage`中添加键值对。
```javascript
// 向 sessionStorage 中存储数据
sessionStorage.setItem('username', 'John'); 

// 向 localStorage 中存储数据
localStorage.setItem('theme', 'dark'); 
```
- **读取数据（`getItem`）**：通过`getItem`方法获取存储的数据，如果指定的键不存在，则返回`null`。
```javascript
const username = sessionStorage.getItem('username'); 
const theme = localStorage.getItem('theme'); 
```
- **删除数据（`removeItem`）**：使用`removeItem`方法可以删除指定键的数据。
```javascript
sessionStorage.removeItem('username'); 
localStorage.removeItem('theme'); 
```
- **清除所有数据（`clear`）**：`clear`方法会一次性删除`sessionStorage`或`localStorage`中存储的所有数据。
```javascript
sessionStorage.clear(); 
localStorage.clear(); 
```

注意事项
- **数据类型转换**：由于`sessionStorage`和`localStorage`==只能存储字符串==，当存储对象、数组等复杂数据类型时，==需要使用`JSON.stringify`将其转换为字符串==，读取时再使用`JSON.parse`转换回原数据类型。
```javascript
const user = { name: 'Alice', age: 30 };
// 存储对象
localStorage.setItem('user', JSON.stringify(user)); 

// 读取对象
const retrievedUser = JSON.parse(localStorage.getItem('user')); 
```
- **存储容量限制**：不同浏览器对`sessionStorage`和`localStorage`的存储容量限制有所不同，一般来说，==大约在5 - 10MB之间==。如果存储的数据超过了限制，会抛出`QuotaExceededError`异常 。
 - **安全性**：它们存储在客户端，数据相对容易被获取，==不适合存储敏感信息==（如密码等）。同时，在使用`localStorage`时，要注意防止跨站点脚本攻击（XSS），因为攻击者可能会利用漏洞读取或修改`localStorage`中的数据。 
![[Pasted image 20250903174959.png]]

# cookie
---
![[Pasted image 20250903180922.png]]

![[Pasted image 20250903181000.png]]
只能浏览器和服务端控制
# Cookie
---
##### Cookie 属性详解
```javascript
// Cookie 格式：key=value; attributes
document.cookie = "username=john; domain=.example.com; path=/; max-age=3600; secure; samesite=strict";
```

[补充说明]：Cookie 主要属性包括：
- **key=value**：键值对（[原笔记：fatty，修正为键值对]）
- **domain**：作用域名
  - 设置为 `.a.com` 与`a.com`可作用于 a.com 及其所有子域名
  - 不设置和设置则仅作用于当前域名
- **path**：URL路径限制（较少使用）
- **max-age**：存活时间（秒），优先级高于expires
  - 正数：存活时间
  - 0：立即删除
  - 负数：会话结束时删除
- **expires**：绝对过期时间（GMT格式）
- **secure**：仅通过HTTPS传输
- **httponly**：禁止JavaScript访问（增强安全性）
- **samesite**：跨站请求限制
  - `Strict`：严格模式，完全禁止跨站发送
  - `Lax`：宽松模式，允许部分安全请求跨站发送
  - `None`：无限制（必须与secure同时使用）
##### CORS 跨域资源共享
[补充说明]：跨域请求处理机制：
- **简单请求**：直接发送，包含Origin头部
- **非简单请求**：先发送OPTIONS预检请求

服务器响应头部：
```http
Access-Control-Allow-Origin: https://example.com  # 允许的源
Access-Control-Allow-Methods: GET, POST, PUT      # 允许的方法
Access-Control-Allow-Credentials: true            # 是否允许携带凭证
Access-Control-Max-Age: 86400                     # 预检请求缓存时间
```